# This is the template containing channels 
# with status data for the givem bootPC
# the status conatins: CPU load
#                      MEM usage info
#                      Boot time info
record (calcout, "$(P)CNT")
{
    field (DESC, "Seconds since last reboot")
    field (EGU,  "s")
    field (SCAN, "1 second")
    field (PINI, "YES")
    field (INPA, "$(P)CNT")
    field (CALC, "A+1")
    field (OCAL, "A&1")
    field (DOPT, "Use OCAL")
    field (OUT,  "$(P)WD PP")
}
record (bo, "$(P)WD")
{
}
record(calc,"$(P)HBTMOD")
{
    field(DESC, "Heartbeat mod 9")
    field(SCAN, "1 second")
    field(CALC, "A%9")
    field(INPA, "$(P)HBT.VAL .NPP.NMS")
    field(EGU,  "ticks")
    field(PREC, "0")
}
record(calc,"$(P)HBT") {
    field(DESC, "IOC heartbeat")
    field(SCAN, "1 second")
    field(FLNK, "$(P)HBTMOD.VAL ")
    field(CALC, "A>=B?0:A+1")
    field(INPA, "$(P)HBT.VAL .NPP.NMS")
    field(INPB, "98")
    field(EGU,  "ticks")
    field(PREC, "0")
}

#----------------------------------------------------
#                   MEMORY STATUS
#----------------------------------------------------

# $(P)MEM record is the process record that synchronises all other MEM records# on the device supprot level 

record(ai, "$(P)MEM")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
    field(SCAN,"5 second")
	field(PREC,"0")
    field(INP, "#C0 S0 @PROC")
	field(PINI,"YES")
	field(FLNK,"$(P)MEMAV")
}
record(ai, "$(P)MEMAV")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")	
    field(INP, "#C0 S0 @MEMAV")
	field(EGU, "KB")
    field(FLNK,"$(P)MEMUSED")
}
record(ai, "$(P)MEMUSED")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @MEMUSED")
	field(EGU, "KB")
    field(FLNK,"$(P)MEMFREE")
}
record(ai, "$(P)MEMFREE")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @MEMFREE")
	field(EGU, "KB")
    field(FLNK,"$(P)MEMSHRD")
}
record(ai, "$(P)MEMSHRD")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @MEMSHRD")
	field(EGU, "KB")
    field(FLNK,"$(P)MEMBUFF")
}
record(ai, "$(P)MEMBUFF")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @MEMBUFF")
	field(EGU, "KB")
	field(FLNK,"$(P)SWAPAV")
}
record(ai, "$(P)SWAPAV")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")	
    field(INP, "#C0 S0 @SWAPAV")
	field(EGU, "KB")
    field(FLNK,"$(P)SWAPUSED")
}
record(ai, "$(P)SWAPUSED")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @SWAPUSED")
	field(EGU, "KB")
    field(FLNK,"$(P)SWAPFREE")
}
record(ai, "$(P)SWAPFREE")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
    field(INP, "#C0 S0 @SWAPFREE")
	field(EGU, "KB")
    field(FLNK,"$(P)SWAPCACH")
}
record(ai, "$(P)SWAPCACH")
{
    field(DESC, "Avg Load")
    field(DTYP, "MemLoad")
	field(PREC,"0")
	field(EGU, "KB")
    field(INP, "#C0 S0 @SWAPCACH")
}

#----------------------------------------------
#          	   TIME STATUS
#----------------------------------------------


record(stringin, "$(P)UPTIME")
{
    field(DESC, "Up time")
    field(DTYP, "UpTime")
	field(INP, "#C0 S0 @UPTIME")
	field(SCAN,"10 second")
	field(FLNK, "$(P)TIME")
	field(PINI, "YES")
}
record(stringin, "$(P)TIME")
{
    field(DESC, "Current time")
    field(DTYP, "UpTime")
    field(INP, "#C0 S0 @CURTIME")
    #field(FLNK, "$(P)BOOTTIME")
}
record(stringin, "$(P)BOOTTIME")
{
    field(DESC, "Boot  time")
    field(DTYP, "UpTime")
    field(INP, "#C0 S0 @BOOTIME")
	field(PINI, "YES")
}

#---------------------------------------------------
#               LOAD AVG
#---------------------------------------------------

record(ai, "$(P)LOAD1MIN")
{
    field(DESC, "Avg Load")
    field(DTYP, "AvgLoad")
	field(INP, "#C0 S0 @1min")
    field(SCAN,"10 second")
	field(PREC,"2")
	field(PINI, "YES")
	field(FLNK,"$(P)LOAD5MIN")
}
record(ai, "$(P)LOAD5MIN")
{
    field(DESC, "Avg Load")
    field(DTYP, "AvgLoad")
    field(INP, "#C0 S0 @5min")
	field(PREC,"2")
    field(FLNK,"$(P)LOAD15MIN")
}
record(ai, "$(P)LOAD15MIN")
{
    field(DESC, "Avg Load")
    field(DTYP, "AvgLoad")
    field(INP, "#C0 S0 @15min")
	field(PREC,"2")
}

#----------------------------------------------------
#               CPU load STATUS
#----------------------------------------------------
# $(P)CPU record is the process record that synchronises all other CPU records# on the device supprot level 


record(ai, "$(P)CPU")
{
    field(DESC, "Avg Load")
    field(DTYP, "CpuLoad")
    field(SCAN,"5 second")
    field(INP, "#C0 S0 @PROC")
	field(PINI,"YES")
	field(FLNK,"$(P)CPUIDLE")
}
record(ai, "$(P)CPUIDLE")
{
    field(DESC, "Avg Load")
    field(DTYP, "CpuLoad")
    field(PREC,"2")
    field(INP, "#C0 S0 @IDLE")
	field(EGU, "%")
    field(FLNK,"$(P)CPUNICE")
}
record(ai, "$(P)CPUNICE")
{
    field(DESC, "Avg Load")
    field(DTYP, "CpuLoad")
    field(INP, "#C0 S0 @NICE")
	field(EGU, "%")
	field(PREC,"2")
    field(FLNK,"$(P)CPUSYSTEM")
}
record(ai, "$(P)CPUSYSTEM")
{
    field(DESC, "Avg Load")
    field(DTYP, "CpuLoad")
    field(INP, "#C0 S0 @SYSTEM")
	field(PREC,"2")
	field(EGU, "%")
    field(FLNK,"$(P)CPUUSER")
}
record(ai, "$(P)CPUUSER")
{
    field(DESC, "Avg Load")
    field(DTYP, "CpuLoad")
	field(PREC,"2")
    field(INP, "#C0 S0 @USER")
	field(EGU, "%")
	field(FLNK,"$(P)LOAD")
}
record(calc, "$(P)LOAD")
{
    field(DESC, "CPU LOAD")
	field(PREC,"2")
    field(INPA, "$(P)CPUUSER")
	field(INPB, "$(P)CPUNICE")
	field(INPC, "$(P)CPUSYSTEM")
	field(CALC, "A + B + C")
	field(EGU, "%")
}

#-------------------------------------------------
#               SYSTEM INFO
#------------------------------------------------

record(stringin, "$(P)EPICSVER")
{
    field(DESC, "EPICS version")
    field(DTYP, "EpicsVer")
    field(PINI, "YES")
}
record(stringin, "$(P)IPADDR")
{
    field(DESC, "Up time")
    field(DTYP, "IpAddr")
    #field(INP, "#C0 S0 @UPTIME")
    #field(SCAN,"10 second")
    field(PINI, "YES")
}
record(stringin, "$(P)MACADDR")
{
    field(DESC, "Up time")
    field(DTYP, "MacAddr")
    #field(INP, "#C0 S0 @UPTIME")
    #field(SCAN,"10 second")
    field(PINI, "YES")
}
record(stringin, "$(P)NETMASK")
{
    field(DESC, "Up time")
    field(DTYP, "NetMask")
    #field(INP, "#C0 S0 @UPTIME")
    #field(SCAN,"10 second")
    field(PINI, "YES")
}
record(stringin, "$(P)SYSNAME")
{
    field(DESC, "System name")
    field(DTYP, "SysInfo")
	field(INP,  "#C0 S0 @SYSNAME")
    field(PINI, "YES")
}
record(stringin, "$(P)NODENAME")
{
    field(DESC, "Nodename")
    field(DTYP, "SysInfo")
	field(INP,  "#C0 S0 @NODENAME")
    field(PINI, "YES")
}
record(stringin, "$(P)RELEASE")
{
    field(DESC, "Up time")
    field(DTYP, "SysInfo")
    field(INP,  "#C0 S0 @RELEASE")
    field(PINI, "YES")
}
record(stringin, "$(P)VERSION")
{
    field(DESC, "Up time")
    field(DTYP, "SysInfo")
    field(INP,  "#C0 S0 @VERSION")
    field(PINI, "YES")
}
record(stringin, "$(P)MACHINE")
{
    field(DESC, "Up time")
    field(DTYP, "SysInfo")
    field(INP,  "#C0 S0 @MACHINE")
    field(PINI, "YES")
}

#-------------------------------------------------
#               IOC UPTIME
#------------------------------------------------

record(swait, "$(P)IOC-CLOCK")
{
    field(DESC, "IOC seconds clock")
    field(SCAN, "1 second")
    field(PINI, "YES")
    field(PREC, "0")
    field(VAL,  "1")
    field(INAN, "$(P)IOC-CLOCK.VAL")
    field(CALC, "(A+1)%60")
    field(OUTN, "$(P)IOC-UPTIME.PROC")
}
record(transform,"$(P)IOC-UPTIME")
{
    field(DESC, "IOC uptime")
    field(SCAN, "Passive")
    field(PREC, "0")
    field(CMTA, "Seconds")
    field(CMTB, "Minutes")
    field(CMTC, "Hours")
    field(CMTD, "Days")
    field(CLCB, "((A==0)?B+1:B)%60")
    field(CLCC, "((A==0)&&(B==0)?C+1:C)%24")
    field(CLCD, "((A==0)&&(B==0)&&(C==0)?D+1:D)")
    field(INPA, "$(P)IOC-CLOCK.VAL NPP NMS")
}
