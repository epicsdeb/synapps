
                                      Argonne National Laboratory
                                   APS Engineering Support Division
                                Beamline Controls and Data Acquisition

                                      EPICS Brick Support (EBRICK)
--------------------------------------------------------------------------------------------------------------

The EPICS brick (EBRICK) is designed to be a low cost solution for an IOC with soft real-time requirements. The
next generation EBRICK, referred to as EBRICK-II, aligns as close as possible with suggestions made by the
review committee (ICMS:APS_1239772) as well as replaces the Athena from Diamond Systems since it is now at end
of life (announced 2008.01.23). The EBRICK-II is based on the Poseidon Single Board Computer (SBC) from Diamond
Systems. It consists of both PC104 and PC104+ busses, fanless 1GHz VIA Eden ULV processor, 512MB DDR2 RAM, 4
serial ports, 4 USB 2.0 ports, VGA, PS/2 mouse and keyboard, 10/100/1000 Ethernet, SATA/IDE interface, ACPI
power management, 32 16bit ADCs, 4 12bit DACs, and 24bit digital IO. This configuration provides a cost effective
solution with sufficient processing power, longevity, and functionality for soft IOC real-time requirements.
Furthermore, other COTS (commercial off-the-shelf) modules as well as in-house developed PC104/PC104+ modules
can be incorporated. 

The Poseidon can be purchased from Diamond Systems, refer to www.diamondsystems.com for addition information
about the processor boards. The recommended hardware for an EPICS Brick IOC consists of the following.

    Poseidon SBC            PSDE10-512A (http://www.diamondsystems.com/products/poseidon)
    Triton enclosure (3")   TRI-PSDA-KIT (http://www.diamondsystems.com/products/triton)
    60GB hard drive         HITACHI TRAVELSTAR 5K160 HDD (0A28416)

As mentioned above, the previous implementation was based on the PC104 Athena Single Board Computer from Diamond
Systems Corporation. Although it is at end of life, support is still provided by BCDA. It consists of a Pentium
III based processor clocked at 660Mhz, 128Mb of RAM, 4 serial ports,4 USB (1.0) ports, VGA, mouse, and keyboard
inputs, 16 ADCs at 16bit, 4 DACs at 12bit, 3 banks of 8bit digital IO, and a 40GB hard drive.

The EBRICK is no longer distributed with EPICS base or synApps. EPICS base 3.14.8.2 and synApps 5.2.1 are known to
work. EPICS base can be acquired from the EPICS website and synApps from the BCDA website. The EBRICK module is part
of synApps and can be acquired from the BCDA website as well. The Linux distribution employed is VectorLinux standard
5.1 and is a lightweight, fast distribution, that uses less than 2Gb of disk space. The kernel is 2.6.19 with a
real-time patch from OSADL (Open Source Automation Development Lab) and the chosen windows display manager is IceWM
because it is small, fast, and lightweight.

Beginning with release R2-2-2, the EBRICK module can be built for RTEMS using the uCDIMM Coldfire processor (uC5282)
from Arcturus Networks. At this time, the supported features include 6 10-bit AD channels, a CPU load monitor as
provided by the MCF5282 module, and a serial console port and a second serial port supported through Asyn. The
future configuration is to employ the uC5282 interface board from the AES Controls group (06PC012A) and mount it
on the BC-071 Cyclone-II FPGA-based board. This will provide a cost effect solution that harnesses the power of an
FPGA with an low cost EPICS interface.

The EBRICK can boot into various configurations as shown below. The default bootup is run level 5 (hdd-service)
but can be changed by editing/etc/lilo.conf as root.

    RUNLEVEL        MENU ID         DESCRIPTION
    5               hdd-service     Logs in epicsioc at ttyS0 (COM1) with 9600 baud,
                                    8bits, no parity, 1 stop bit.
    7               hdd-epicsioc    Logs in epicsioc and runs EPICS at ttyS0 (COM1)
                                    with 9600 baud, 8bits, no parity, 1 stop bit.
    5               nfs-service     Network boot. Logs in epicsioc at ttyS0 (COM1)
                                    with 9600 baud, 8bits, no parity, 1 stop bit.
    7               nfs-epicsioc    Network boot. Logs in epicsioc and runs EPICS at
                                    ttyS0 (COM1) with 9600 baud, 8bits, no parity, 1 stop bit.

At run level 5 (hdd-service and nfs-service), the epicsioc account is automatically logged into at serial port
ttyS0. At run level 7 (hdd-epicsioc and nfs-epicsioc), the epicsioc account is automatically logged in as well,
but an IOC is ran under the screen application. The screen utility is employed to allow multiple logins to attach
to the IOC either locally or remotely (refer to the screen documentation for details). During IOC startup, the
epicsioc account runs the screen application and passes it a startup script (start_epics_ioc). The startup script
points to where the IOC application resides and runs it accordingly. Subsequent logons can be attached to the
iocsh by the commands screen -x or screen -r.

The commercial hardware that is currently supported is listed below. As hardware is upgraded and user requirements
change, additional support will be incorporated.

    MANUFACTURE         WEBSITE                 HARDWARE    PART NUMBER     DESCRIPTION
    Diamond Systems     www.diamondsystems.com  Poseidon    PSDE10-512A     Processor module.
    Diamond Systems                             Ruby-MM-416 RMM-416-XT      4 channel 16bit DACs, 24bit DIO
    Diamond Systems                             Onyx-MM-DIO OMM-DIO-XT      48bit digital IO
    Diamond Systems                             Pearl-MM    PMM-S/P         16bit relay output.
    Sensoray            www.sensoray.com        Smart A/D   518             PC104 bus Smart A/D (8-channel)
    Pro-dex (OMS)       www.prodex.com          Controller  PC68            Multi-axis motion controller


--------------------------------------------------------------------------------------------------------------
Contact information:
Argonne National Laboratory
APS Engineering Support Division
Beamline Controls and Data Acquisition
David Kline
dkline@aps.anl.gov
--------------------------------------------------------------------------------------------------------------
