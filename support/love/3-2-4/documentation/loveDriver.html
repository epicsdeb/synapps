<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>drvLove</TITLE>
	<META NAME="GENERATOR" CONTENT="StarOffice 7  (Solaris Sparc)">
	<META NAME="CREATED" CONTENT="20050810;15185600">
	<META NAME="CHANGED" CONTENT="20060602;14183500">
	<STYLE>
	<!--
		@page { size: 8.5in 11in }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1 ALIGN=CENTER>love: Love Controller Driver Support 
</H1>
<P ALIGN=CENTER><FONT SIZE=4><B>Release 3-2-3</B></FONT></P>
<P ALIGN=CENTER><FONT SIZE=4><B>David Kline</B></FONT></P>
<P ALIGN=CENTER><FONT SIZE=4><B>June 2006</B></FONT></P>
<H3 ALIGN=CENTER><BR><BR>
</H3>
<HR>
<H2 ALIGN=CENTER>License Agreement</H2>
<P>This product is available via the <A HREF="#LicenseAgreement">open
source license</A> described at the end of this document.</P>
<HR>
<H2 ALIGN=CENTER>Overview</H2>
<P>This module is part of synApps to provide support for the Love
Controllers. It consists of MEDM screens, an Asyn-based multi device
port driver, and a database. The MEDM screens provide a way for
viewing the controller values as well as controlling some of its
configuration. The port driver binds generic Asyn device support for
EPICS records with the Asyn serial port driver (drvAsynSerialPort).
The database defines EPICS records, that read/write controller values
and configuration settings.<BR><BR>The Love Controller is an
instrument that can be used to monitor temperature, pressure, serve
as a thermocouple, or control pressure, flow, humidity, motion, or pH
given the proper hardware. The control functions, such as selecting
the input type (voltage, current, etc.), are programmed from the
front panel. Communication with the controller is a half-duplex,
multi drop, RS-485 serial bus. Refer to the documentation for
additional information about the features and programmability of the
instrument. There are several controller models available providing
different options and features, however, this software supports
models 16A and 1600.</P>
<HR>
<H2 ALIGN=CENTER>Files</H2>
<P ALIGN=LEFT>The files listed below are the primary ones in the
identified directory.</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=218>
	<COL WIDTH=969>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>start_epics_love</P>
		</TD>
		<TD WIDTH=969>
			<P>Main MEDM screen startup.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=214>
	<COL WIDTH=973>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./documentation</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>devAsynLoveCrossTraining.ppt</P>
		</TD>
		<TD WIDTH=973>
			<P>Power point presentation given during a BCDA group meeting.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>devAsynLove.ppt</P>
		</TD>
		<TD WIDTH=973>
			<P>Power point presentation given during the EPICS collaboration
			meeting in Spring of 2005 (<A HREF="http://www-ssrl.slac.stanford.edu/lcls/epics/agenda.php">click
			here</A>).</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>loveDriver.html</P>
		</TD>
		<TD WIDTH=973>
			<P>This document.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>loveKnownIssues.html</P>
		</TD>
		<TD WIDTH=973>
			<P>List of known issues for each release.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>loveReleaseNotes.html</P>
		</TD>
		<TD WIDTH=973>
			<P>Notes for current and previous releases.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=214>
			<P>WIRING</P>
		</TD>
		<TD WIDTH=973>
			<P>Diagram for wiring the controllers and other information.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=216>
	<COL WIDTH=971>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./documentation/1600</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=216>
			<P>1600_Calibration.pdf</P>
		</TD>
		<TD WIDTH=971>
			<P>Calibration document for the 1600.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=216>
			<P>1600_CommProtocol.pdf</P>
		</TD>
		<TD WIDTH=971>
			<P>Communication protocol/commands for the 1600.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=216>
			<P>1600_Documentation.pdf</P>
		</TD>
		<TD WIDTH=971>
			<P>Users manual.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=218>
	<COL WIDTH=969>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./documentation/16A</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_Calibration.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>Calibration document for the 16A.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_CommDoc.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>Communication protocol/commands for the 16A.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_CommProtocol.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>Instructions about how to write your own application to
			communicate with the 16A.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_DataSheet.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>General information.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_Documentation.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>Users manual.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=218>
			<P>16A_FlowChart.pdf</P>
		</TD>
		<TD WIDTH=969>
			<P>Programming flow chart.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=219>
	<COL WIDTH=968>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./documentation/485LDRC</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=219>
			<P>485LDRC_Connections.gif</P>
		</TD>
		<TD WIDTH=968>
			<P>Wiring diagram.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=219>
			<P>485LDRC_Datasheet.pdf</P>
		</TD>
		<TD WIDTH=968>
			<P>General information.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=219>
			<P>485LDRC_Dimentions.gif</P>
		</TD>
		<TD WIDTH=968>
			<P>Installation diagram.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=220>
	<COL WIDTH=967>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./iocBoot/ioclove</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=220>
			<P>st.cmd.linux</P>
		</TD>
		<TD WIDTH=967>
			<P>Startup script for Linux-based IOCs.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=220>
			<P>st.cmd.vx</P>
		</TD>
		<TD WIDTH=967>
			<P>Startup script for vxWorks-based IOCs.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=4>
	<COL WIDTH=221>
	<COL WIDTH=963>
	<TR>
		<TD COLSPAN=2 WIDTH=1192>
			<P ALIGN=CENTER>./loveApp/Db</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=221>
			<P>LoveControllerControl.db</P>
		</TD>
		<TD WIDTH=963>
			<P>PVs for setting controller configuration.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=221>
			<P>LoveController.db</P>
		</TD>
		<TD WIDTH=963>
			<P>PVs for reading information from the controller.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=221>
			<P>Love_settings.req</P>
		</TD>
		<TD WIDTH=963>
			<P>Request file for auto save/restore.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=223>
	<COL WIDTH=964>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./loveApp/op/adl</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=223>
			<P>LoveController.adl</P>
		</TD>
		<TD WIDTH=964>
			<P>Main read back screen.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=223>
			<P>LoveControllerControl.adl</P>
		</TD>
		<TD WIDTH=964>
			<P>Displays additional read back and configuration information.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=223>
			<P>LoveControllerFanout.adl</P>
		</TD>
		<TD WIDTH=964>
			<P>Displays PV and rate information.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<TABLE WIDTH=1206 BORDER=1 CELLPADDING=2 CELLSPACING=3>
	<COL WIDTH=224>
	<COL WIDTH=963>
	<TR>
		<TD COLSPAN=2 WIDTH=1194>
			<P ALIGN=CENTER>./loveApp/src</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=224>
			<P>drvLove.c</P>
		</TD>
		<TD WIDTH=963>
			<P>Asyn-based multi device port driver.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=224>
			<P>loveAppCommonInclude.dbd</P>
		</TD>
		<TD WIDTH=963>
			<P>Basic database definition from base, Asyn, and for Love
			controller support.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=224>
			<P>loveAppInclude.dbd</P>
		</TD>
		<TD WIDTH=963>
			<P>Primary database definition file.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=224>
			<P>loveAppVXInclude.dbd</P>
		</TD>
		<TD WIDTH=963>
			<P>vxWorks-specific database definition file.</P>
		</TD>
	</TR>
	<TR>
		<TD WIDTH=224>
			<P>devLove.dbd</P>
		</TD>
		<TD WIDTH=963>
			<P>Necessary for other components to import Love Controller
			support.</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<HR>
<H2 ALIGN=CENTER>MEDM Screens</H2>
<P>When the script 'start_epics_love' is executed, the main
controller screen is displayed (see below). It displays the values
that are of most interest to the user. These values include the read
back, set points, alarm limits, and indicates whether the controller
is in alarm. The 'ENABLE' menu provides a means for
disabling/enabling record processing. When disabled the records will
not be processed and no data acquisition will be performed. <BR><BR><BR>
</P>
<P><IMG SRC="LoveController.jpeg" NAME="LoveController" ALIGN=LEFT WIDTH=238 HEIGHT=206 BORDER=0><BR CLEAR=LEFT><BR>A
hidden menu is available in the upper right hand corner of the main
screen. It displays additional values, such as input type and
communication status, as well as allows one to make adjusts to some
of the configuration parameters (i.e. set point 1 and scan rate). The
display is illustrated below. <BR><BR><BR>
</P>
<P><A NAME="Fanout"></A><IMG SRC="LoveControllerControl.jpeg" NAME="Graphic4" ALIGN=LEFT WIDTH=373 HEIGHT=461 BORDER=0><BR CLEAR=LEFT><BR>Additionally,
the &ldquo;Fast Fanout&rdquo; or &ldquo;Slow Fanout&rdquo; message
buttons launch other screens that list which PVs are being acquired
and at what rate. The user can enter additional PVs or change the
data acquisition rate. Furthermore, it should be noted that once the
IOC is rebooted, the fanout records will be reset to the original
PVs. These displays are illustrated below. The corresponding database
records require modification to preserve any changes made at runtime.
<BR><BR><BR><BR>
</P>
<P STYLE="margin-bottom: 0in"><IMG SRC="LoveControllerFanout.jpeg" NAME="Graphic5" ALIGN=LEFT WIDTH=526 HEIGHT=295 BORDER=0><BR CLEAR=LEFT><BR>
</P>
<P><IMG SRC="LoveControllerSlowFanout.jpeg" NAME="Graphic6" ALIGN=LEFT WIDTH=524 HEIGHT=295 BORDER=0><BR CLEAR=LEFT><BR><BR>
</P>
<HR>
<H2 ALIGN=CENTER>drvLove</H2>
<P>The drvLove is a multi device port driver that binds standard
EPICS device support with the underlying serial bus. It allows a
virtual connection to an individual controller to provide a means for
debugging the communication. The asynRecord can be used to select the
tracing masks for debugging communication.<BR><BR>The driver
implements the asynDrvUser, asynCommon, asynInt32, and
asynUInt32Digital interfaces.</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">asynDrvUser &ndash; Describes the
	methods to allow an asynUser to communicate user specific
	information to/from the port driver.</P>
	<LI><P STYLE="margin-bottom: 0in">asynCommon &ndash; Describes the
	methods that must be implemented by drivers for reporting driver
	information and how to connect or disconnect from the driver.</P>
	<LI><P STYLE="margin-bottom: 0in">asynInt32 &ndash; Describes the
	methods that use integers for communicating with a device.</P>
	<LI><P STYLE="margin-bottom: 0in">asynUInt32Digital &ndash;
	Describes the methods for communicating via bits of an Int32
	register.</P>
</UL>
<HR>
<H2 ALIGN=CENTER STYLE="margin-top: 0in; margin-bottom: 0in">Database</H2>
<P ALIGN=LEFT STYLE="margin-bottom: 0in"><BR>
</P>
<P ALIGN=LEFT STYLE="margin-bottom: 0in">The database consists of
records for processing data received by the controllers. Records are
categorized as base, composite, and rate. Base records provide
integer-based values that are read from a controller and include
values such as the number of decimal points, set point 1 and 2, alarm
high and low, and status. Composite records take as input base
records to derive floating point representations of the values. For
example, set point 1 is a calc record that receives as input the
decimal points and the set point record values, then uses its CALC
equation to determine the final floating point set point value. By
default, both the base and composite records are process passive and
are processed using fanout records. The fanout records are used to
&ldquo;drive&rdquo; the processing rate of the base and composite
records. At the moment there are two fanout records for fast and slow
record processing, their scan rates can be adjusted from MEDM <A HREF="#Fanout">screens</A>
. <B>Note</B> that the &ldquo;getDecpts&rdquo; PV must be in the
&ldquo;Fast&rdquo; fanout record at all times. This value is required
since it is used by many PVs to derive their floating point value.</P>
<HR>
<H2 ALIGN=CENTER>Operation</H2>
<P>The driver is initialized during IOC startup by calling the
drvLoveInit method passing the driver name (i.e. &ldquo;LO&rdquo;)
and the name of the serial port. The initialization method first
connects with the serial port name and finds the asynOctet interface.
Then it registers the port driver name with Asyn and the interfaces
it supports (i.e. asynDrvUser, asynCommon, asynInt32, and
asynUInt32Digital). The port driver must be made aware of the
controller models on the serial bus. To do this the startup script
calls the drvLoveConfig method passing the port driver name (i.e.
&ldquo;LO&rdquo;), the controller address (i.e. 1..256), and the
controller model string (i.e. &ldquo;16A&rdquo; or &ldquo;1600&rdquo;).
After this, the database can be loaded creating the record instances
that support the controllers.<BR><BR>Prior to initializing the
driver, Asyn and the underlying serial bus must be initialized. Refer
to the target-specific startup script located in the iocBoot
directory for details related to initialization.</P>
<HR>
<H2 ALIGN=CENTER><A NAME="LicenseAgreement"></A>License Agreement</H2>
<PRE>Copyright (c) 2004 University of Chicago and the Regents of the University of
California. All rights reserved.

synApps is distributed subject to the following license conditions:
SOFTWARE LICENSE AGREEMENT
Software: synApps
Versions: Release 4-5 and higher.

   1. The &quot;Software&quot;, below, refers to synApps (in either source code, or
      binary form and accompanying documentation). Each licensee is addressed
      as &quot;you&quot; or &quot;Licensee.&quot;

   2. The copyright holders shown above and their third-party licensor's hereby
      grant Licensee a royalty-free nonexclusive license, subject to the
      limitations stated herein and U.S. Government license rights.

   3. You may modify and make a copy or copies of the Software for use within
      your organization, if you meet the following conditions:
         1. Copies in source code must include the copyright notice and this
            Software License Agreement.
         2. Copies in binary form must include the copyright notice and this
            Software License Agreement in the documentation and/or other
            materials provided with the copy.

   4. You may modify a copy or copies of the Software or any portion of it, thus
      forming a work based on the Software, and distribute copies of such work
      outside your organization, if you meet all of the following conditions:
         1. Copies in source code must include the copyright notice and this
            Software License Agreement;
         2. Copies in binary form must include the copyright notice and this
            Software License Agreement in the documentation and/or other
            materials provided with the copy;
         3. Modified copies and works based on the Software must carry
            prominent notices stating that you changed specified portions of
            the Software.

   5. Portions of the Software resulted from work developed under a
      U.S. Government contract and are subject to the following license:
      the Government is granted for itself and others acting on its behalf a
      paid-up, nonexclusive, irrevocable worldwide license in this computer
      software to reproduce, prepare derivative works, and perform publicly and
      display publicly.

   6. WARRANTY DISCLAIMER. THE SOFTWARE IS SUPPLIED &quot;AS IS&quot; WITHOUT WARRANTY OF
      ANY KIND. THE COPYRIGHT HOLDERS, THEIR THIRD PARTY LICENSORS, THE UNITED
      STATES, THE UNITED STATES DEPARTMENT OF ENERGY, AND THEIR EMPLOYEES: (1)
      DISCLAIM ANY WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
      ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
      PURPOSE, TITLE OR NON-INFRINGEMENT, (2) DO NOT ASSUME ANY LEGAL LIABILITY
      OR RESPONSIBILITY FOR THE ACCURACY, COMPLETENESS, OR USEFULNESS OF THE
      SOFTWARE, (3) DO NOT REPRESENT THAT USE OF THE SOFTWARE WOULD NOT
      INFRINGE PRIVATELY OWNED RIGHTS, (4) DO NOT WARRANT THAT THE SOFTWARE WILL
      FUNCTION UNINTERRUPTED, THAT IT IS ERROR-FREE OR THAT ANY ERRORS WILL BE
      CORRECTED.

   7. LIMITATION OF LIABILITY. IN NO EVENT WILL THE COPYRIGHT HOLDERS, THEIR
      THIRD PARTY LICENSORS, THE UNITED STATES, THE UNITED STATES DEPARTMENT OF
      ENERGY, OR THEIR EMPLOYEES: BE LIABLE FOR ANY INDIRECT, INCIDENTAL,
      CONSEQUENTIAL, SPECIAL OR PUNITIVE DAMAGES OF ANY KIND OR NATURE,
      INCLUDING BUT NOT LIMITED TO LOSS OF PROFITS OR LOSS OF DATA, FOR ANY
      REASON WHATSOEVER, WHETHER SUCH LIABILITY IS ASSERTED ON THE BASIS OF
      CONTRACT, TORT (INCLUDING NEGLIGENCE OR STRICT LIABILITY), OR OTHERWISE,
      EVEN IF ANY OF SAID PARTIES HAS BEEN WARNED OF THE POSSIBILITY OF SUCH
      LOSS OR DAMAGES.</PRE>
</BODY>
</HTML>