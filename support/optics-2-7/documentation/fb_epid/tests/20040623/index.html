<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><!-- InstanceBegin template="/Templates/unicat.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<link href="/Style_Sheets/anl.css" rel="stylesheet" type="text/css">
<link href="/Style_Sheets/unicat.css" rel="stylesheet" type="text/css">
<script language="JavaScript" src="/Javascripts/anlmain.js" type="text/JavaScript"></script>
<!-- InstanceBeginEditable name="title" --><title>PID feedback notes 2004-06-23</title><!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="metadata" -->
<meta name="description" content="">
<meta name="keywords" content=""> 
<meta name="classification" content="">
<meta name="author" content="Argonne National Laboratory">
<meta name="expires" content="">
<style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, mono}
-->
</style>
<!-- InstanceEndEditable -->

</head>
<body>
<table width="100%" border="0" cellpadding="0" cellspacing="3"> 
  <tr> 
    <td colspan="3"><!-- #BeginLibraryItem "/Library/UNICAT/unicat_identity.lbi" -->
<table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr valign="middle">
        <td width="4" valign="middle" class="blueBkgdDark"><img src="/ANL_Components/Images/spacer.gif" height="1" width="1" border="0" alt=""></td>
		<td width="124" valign="middle" class="blueBkgdDark"><a href="/"><img src="../../../../../graphics/unilogo-small.png" alt="UNICAT logo" width="124" height="50" border="0"></a></td>
		<td width="10" valign="middle" background="/ANL_Components/Images/header_gradient.gif"><img src="/ANL_Components/Images/spacer.gif" width="10" height="8" border="0" alt=""></td>        
		<td width="610" valign="middle" class="blueBkgdDark"><span class="sectionTitle">XOR-UNI<BR>
        <SMALL>
	      A University 
			- National laboratory 
			- Industry 
			Collaborative Access Team
	    at the Advanced Photon Source now operated by APS X-Ray Operations &amp; Research (XOR) </SMALL></span>        </td>
        <td width="4" valign="middle" background="/ANL_Components/Images/header_gradient.gif">
		  <img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt="">
		</td>
        <td width="200" height="50" align="right" valign="middle"><a href="http://www.aps.anl.gov"><img src="/ANL_Components/Images/Logos/apslogolvd.gif" alt="Advanced Photon Source at Argonne National Laboratory" width="200" height="70" border="0"></a></td>
      </tr>
</table>
<!-- #EndLibraryItem --></td> 
  </tr> 
  <tr> 
    <td colspan="3"><!-- #BeginLibraryItem "/Library/UNICAT/unicat_navigation.lbi" --><script type="text/javascript" language="JavaScript1.2" src="../../../../../Javascripts/stm31.js"></script>
 <table width="100%"  border="0" cellspacing="0" cellpadding="0"> 
  <tr> 
     <td width="141" nowrap class="greyBkgdVeryDark"> <span class="UNI_nav_item"> <a href="../../../../../admin/sciprog.html">Scientific Programs </a> &nbsp; </span> </td> 
     <td width="4" nowrap><img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt=" "></td> 
     <td width="71" nowrap class="greyBkgdVeryDark"> <span class="UNI_nav_item"><a href="../../../../../admin/instruments.html">Instruments</a>&nbsp; </span> </td> 
     <td width="4" nowrap><img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt=" "></td> 
     <td width="140" nowrap class="greyBkgdVeryDark"> <span class="UNI_nav_item"><a href="../../../../../admin/forms.html">Forms & Schedules </a></span> </td> 
     <td width="4" nowrap><img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt=" "></td> 
     <td width="59" nowrap class="greyBkgdVeryDark"> <span class="UNI_nav_item"><a href="/linpha/">Photos</a>&nbsp; </span> </td> 
     <td width="4" nowrap><img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt=" "></td> 
     <td width="68" nowrap class="greyBkgdVeryDark"> <span class="UNI_nav_item"><a href="../../../../../controls">Controls</a>&nbsp; </span> </td> 
     <td width="4" nowrap><img src="/ANL_Components/Images/spacer.gif" width="1" height="1" border="0" alt=" "></td> 
     <td width="199" align="right" bgcolor="#FFFFFF" class="greyBkgdVeryDark"><span class="UNI_nav_item"></span></td> 
   </tr> 
</table> 
<!-- #EndLibraryItem --></td> 
  </tr> 
  <tr> 
    <td colspan="3" class="greyBkgdLight"><!-- #BeginLibraryItem "/Library/UNICAT/unicat_breadcrumbs.lbi" class="greyBkgdMedium" --><span class="breadcrumbs">
<a href="http://www.anl.gov">Argonne Home</a> > 
<!-- If a division use this -->
<!--
<a href="http://www.anl.gov/Science_and_Technology/divisions.html">Research Divisions</a> > 
-->
<!-- If a facility use this -->
<!-- Place your division (or facility) name here with the appropriate address -->
<a href="http://www.aps.anl.gov">Advanced Photon Source </a> >
<a href="/">UNICAT</a> >
<!-- Script to automatically create breadcrumbs that point to directory/index.html and use directory as the breadcrumb name. -->
<script type="text/javascript" language="JavaScript">anlBreadCrumbs("www.uni.aps.anl.gov");</script>
</span>
<!-- #EndLibraryItem --></td>
  </tr> 

  <tr valign="top"> 
    <td width="180" nowrap class="relatedNavigationBox"> <table width="100%" border="0" cellpadding="6" cellspacing="0">
      <tr>
        <td class="relatedLogo"><!-- InstanceBeginEditable name="leftLogo" --><! logo here><!-- InstanceEndEditable --></td>
      </tr><tr>
        <td class="relatedNavigation"><!-- InstanceBeginEditable name="leftMenu" --><!-- InstanceEndEditable --></td>
      </tr>
    </table></td> 
    <td width="765"><table width="100%" border="0" cellpadding="5" cellspacing="0"><tr>
      <td><!-- InstanceBeginEditable name="mainFeature" -->
        <h1 class="UNI_headline">Use of the EPID record for feedback at UNICAT</h1>
        <p>An <span class="style1">swait</span> (calculation) record was used to simulate a crystal reflection (Lorentzian peak shape) and to calculate the response of the crystal to different parameters using EPICS records. The various ananlog output (<span class="style1">ao</span>) records are used (by name) as inputs to the <span class="style1">swait</span> record. A state notation (SNL) program was written to generate Gaussian-probability (zero mean, unit standard deviation) random numbers to simulate experimental noise. The ideal position of the reflection is also adjusted by the SNL program to simulate drift in the ideal tuning position for the crystal element. An additional Gaussian random number was used to provide a small amplitude of jitter to the ideal position.</p>
        <table>
          <caption class="blackBkgd">
          hnl:userCalc10 value for epid_test:response function
          </caption>
          <tr>
            <th class="blueBkgdMedium" scope="row">A</th>
            <td class="MeetingCellText">hnl:epid:positioner.VAL</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">B</th>
            <td class="MeetingCellText">hnl:epid:resp:ideal</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">C</th>
            <td class="MeetingCellText">hnl:epid:resp:sigma</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">D</th>
            <td class="MeetingCellText">hnl:epid:resp:scale</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">E</th>
            <td class="MeetingCellText">hnl:epid:resp:base</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">F</th>
            <td class="MeetingCellText">hnl:epid:resp:noise</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">G</th>
            <td class="MeetingCellText">1.00002</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">CALC</th>
            <td class="MeetingCellText">G*(D/(1+((A-B)/C)^2)^2+E)</td>
          </tr>
        </table>
        <p>An <span class="style1">epid</span> record provides the means to drive the pseudo-positioner in a closed feedback loop. The epid record can be operated in either a hold constant (PID control) mode or a maximize (or minimize) mode. In the latter mode, negative input signals will be minimized while positive signals are maximized. Consider that the software will only maximize the absolute value of the input signal. The next table shows a working configuration for maximizing the signal generated by the previously-shown calculation. </p>
        <table>
          <caption class="blackBkgd">
   epid_test: working configuration 
          </caption>
          <tr>
            <th class="blueBkgdMedium" scope="row">SCAN</th>
            <td class="MeetingCellText">0.2 seconds </td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">input</th>
            <td class="MeetingCellText">hnl:userCalc10.VAL NPP NMS </td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">KP</th>
            <td class="MeetingCellText">0.004</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">MODE</th>
            <td class="MeetingCellText">Max/Min</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">low limit </th>
            <td class="MeetingCellText">-2</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">high limit </th>
            <td class="MeetingCellText">9</td>
          </tr>
        </table>
        <p>One limitation of the <span class="style1">epid</span> record is that the output link must be a database link. Therefore, it must be defined in the database at boot time, although the string is changeable at run time. (Why is this?) Circumventing this presumed limitation, an <span class="style1">swait</span> record (next table) has been configured to picl up the calculation value from the <span class="style1">epid</span> record and pass it to the chosen positioner, provided that the <span class="style1">epid</span> record feedback mode has been turned on.</p>
        <table>
          <caption class="blackBkgd">
  hnl:userCalc9<br>
  epid_test: position calculation 
          </caption>
          <tr>
            <th class="blueBkgdMedium" scope="row">SCAN</th>
            <td class="MeetingCellText">I/O Intr </td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">A</th>
            <td class="MeetingCellText">hnl:epid:epid.OVAL</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">B</th>
            <td class="MeetingCellText">hnl:epid:epid.FBON</td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">C</th>
            <td class="MeetingCellText"><p>hnl:userCalc9.VAL</p>              </td>
          </tr>
          <tr>
            <th class="blueBkgdMedium" scope="row">CALC</th>
            <td class="MeetingCellText">B?A:C</td>
          </tr>
        </table>
        <h2 class="UNI_headline">Comments</h2>
        <p>Some packaging remains to be completed in order to use the epid record for routine software feedback and replace the existing software feedback. Features of that packaging might include :</p>
        <ul>
          <li>Automatic on/off mode when input signal is out of range </li>
          <li>User selection of input signal(s)</li>
          <li> User selection of positioner</li>
          <li>Preservation of separate tuning parameters for PID and Max/Min modes</li>
          <li>When in Max/Min mode, automatic update of set point to maximum (minimum)</li>
          <li>Scan of positioner through user-specified range to locate peak (?using sscan record?) </li>
          <li>EGU, PREC, DRVH, DRVL fields come from positioner</li>
          <li>Support HOPR and LOPR on GUI screens     </li>
        </ul>
          <!-- InstanceEndEditable --></td>
    </tr></table></td> 
  </tr> 
  <tr valign="top">
    <td colspan="2"><!-- #BeginLibraryItem "/Library/UNICAT/unicat_footer.lbi" --><style type="text/css">
<!--
.style2 {font-size: 10px}
-->
</style>
<hr size="1">
<div align="center">
	    <a href="http://www.mrl.uiuc.edu">
		  <img 
		    src="../../../../../graphics/ui_welcome-small.gif"
			alt="University of Illinois at Urbana-Champaign" 
			width="97" 
			height="50" 
			border="0"
		  ></a>
		<img src="/ANL_Components/Images/spacer.gif" alt=" " width="1" height="1" border="0">
		&nbsp;
		<a href="http://www.ornl.gov">
		 <img 
		   src="../../../../../graphics/ornl_logos2-small.gif" 
		   alt="Oak Ridge National Laboratory" 
		   width="68" 
		   height="50" 
		   border="0"
		 ></a>
		<img src="/ANL_Components/Images/spacer.gif" alt=" " width="1" height="1" border="0">
		&nbsp;
		<a href="http://www.uop.com">
		  <img 
		    src="../../../../../graphics/uoplogo-1-small.gif" 
			alt="UOP, LLC" 
			width="89" 
			height="50" 
			border="0"
		  ></a>
		<img src="/ANL_Components/Images/spacer.gif" alt=" " width="1" height="1" border="0">
		&nbsp;
		<a href="http://www.nist.gov/">
		  <img 
		  src="../../../../../graphics/nistlogo.jpg" 
		  alt="National Institute of Standards and Technology" 
		  height="45" 
		  border="0"
		  ></a> 
		<br />
		<a href="http://www.anl.gov/notice.html">Privacy &amp; Security Notice</a>
		&nbsp;| &nbsp;
		<a href="../../../../../admin/address.html">Contact Us</a> | 
		<a href="../../../../../admin/address.html#residents">Phonebook</a>
		&nbsp; <! | /> &nbsp;
		<! Site Map />
		<BR />
		<span class="style2">This page last modified:
		  <!-- #BeginDate format:IS1a -->2005-05-18 3:14 PM<!-- #EndDate -->
</span></div>
<!-- #EndLibraryItem --></td>
  </tr> 
</table> 
</body>
<!-- InstanceEnd --></html>
