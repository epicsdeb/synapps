scan345(1)                 scan345 V3.0                scan345(1)



NNAAMMEE
       scan345 - terminal program for doing scans and other oper-
       ations on the 345mm mar research  Imaging  Plate  Detector
       System .


SSYYNNOOPPSSIISS
       ssccaann334455  [ --hh ] [ [ --kkeeeepp ] [ --mmoorree _L_E_V_E_L ] [ --hhoosstt _H_O_S_T ]
       [ --ppoorrtt _P_O_R_T ]


DDEESSCCRRIIPPTTIIOONN
       _s_c_a_n_3_4_5 is  a program for performing scanner operations on
       the  _m_a_r  _r_e_s_e_a_r_c_h  Imaging  Plate Detector System without
       graphical user interface.  Input is read  from  a  command
       file  (see  below).  The program exists in two versions to
       cooperate with different  types  of  controllers.  Version
       >=2.0  of scan345 cooperates with scanners with serial no.
       > 043 only, while version 0.x  of  scan345  operates  with
       scanners  from  serial no. 001 to 043. Note, however, that
       even scanners with serial numbers <=  043  may  have  been
       upgraded  to  behave  like  one  of the later models.  For
       scan345 >= 2.0, all scanner functions  can  be  used,  for
       scan345 < 2.0, available program functions are:

        +o Scan the plate.  This involves transformation of spiral
          images into Cartesian images.

        +o Change scan mode.

        +o Erase the plate.


OOPPTTIIOONNSS
       --kkeeeepp  Write  spiral  images  to  disk  during  scan.   By
              default, only transformed images are saved.

       --mmoorree _L_E_V_E_L
              Verbose  output; the amount depends on the value of
              _L_E_V_E_L, which may have a  value  between  0  and  3,
              higher values giving more information.

       --hhoosstt _H_O_S_T
              Connect  to  host  _H_O_S_T_.   By  default, the scanner
              hostname is "mar345"  (192.0.2.1).  The  host  name
              giving  on  the  command line overrides the default
              and the entry in the configuration file.

       --ppoorrtt _P_O_R_T
              Connect to port _P_O_R_T_.  By default,  the  connection
              will  be established through the arbitrary port no.
              4123. The port number given  on  the  command  line
              overrides the default and the entry in the configu-
              ration file.


PPRROOGGRRAAMM FFLLOOWW
       At startup, the program reads internal parameters  from  a
       configuration  file (see below). The program then connects
       to the scanner via the BSD-socket-interface (Ethernet). If
       successful,  the  program  waits for input from file $MAR-
       LOGDIR/mar.com.   This   ASCII-file   contains   keyworded
       commands.  After the input has been processed, the file is
       deleted and the specified command is sent to the  scanner.
       The  progress  of an active command is monitored in output
       file $MARLOGDIR/mar.message. The information in this  file
       refers  to  one  task  only.  The file is truncated at the
       start of each new task.  If the specified command has fin-
       ished,  $MARLOGDIR/mar.message  is  closed and the program
       looks for further commands from  file  $MARLOGDIR/mar.com.
       Only  one  command  can be processed at one time (the last
       COMMAND keyword found in mar.com).   All  log  information
       goes  into  standard  output  and  into the log file $MAR-
       LOGDIR/log/mar.log.NO (see below).


KKEEYYWWOORRDDSS
       The following keywords in  $MARLOGDIR/mar.com  are  manda-
       tory:


       _C_O_M_M_A_N_D _<_t_a_s_k_>
              Specifies the task to execute. Can be: SCAN, ERASE,
              CHANGE, QUIT or LISTEN (scan345  <  2.0)  or  SCAN,
              ERASE,  CHANGE, QUIT, START, INIT, SHUTTER, EXPOSE,
              PHI, DISTANCE and  OMEGA (scan345 >= 2.0).  A  scan
              in  a  different  scanmode automatically involves a
              mode change.  QUIT tells the scanner to  exit  from
              its  listener  program, LISTEN (scan345 < 2.0 only)
              means, that the scanner will wait for another  con-
              nect request.  No default.

       With scan345 >= 2.0, the following commands accept further
       input:

        +o SHUTTER OPEN: Opens shutter

        +o SHUTTER CLOSE: Closes shutter

        +o PHI MOVE <target>: Moves PHI to target (deg.).

        +o PHI DEFINE <target>: Defines PHI as target (deg.).

        +o OMEGA MOVE <target>: Moves OMEGA to target (deg.).

        +o OMEGA DEFINE <target>: Defines OMEGA as target  (deg.).

        +o DISTANCE  MOVE <target>: Moves DISTANCE to target (mm).

        +o DISTANCE DEFINE <target>: Defines  DISTANCE  as  target
          (mm).

        +o INIT   MIN: Initialize distance at near end of transla-
          tion stage.

        +o INIT  MAX: Initialize distance at far end  of  transla-
          tion stage.

        +o EXPOSE [<delta-phi>] ][<units>] [<oscillations>]: Makes
          an  exposure  with  <oscillations>   over   <delta-phi>
          degrees  for  <units> seconds or X-ray counts (default:
          seconds, unless COLLECT DOSE  given;  see  below).  The
          additional  arguments  are  optional,  but if not given
          here, they must be specified with keywords PHI and COL-
          LECT (see below).


       With  scan345  >= 2.2, the SCAN command accepts additional
       input:

        +o SCAN ERASE <n> ADD <m>: After finishing one  scan,  the
          plate  may optionally be erase <n> times, additionally.
          Note that one complete erase cycle consists of  a  scan
          plus approx. 15 seconds of erase. Optionally, data from
          <m> subsequent scans can be added to  the  first  scan.
          The  program will write out resulting images after each
          scan cycle  containing  the  sum  of  added  data.  The
          resulting  output  file will be overwritten until <m>+1
          scans are completed. When saving spiral files, the  raw
          spiral  data  will  be stored as <root>.<c>.sXXXX where
          <c> = a,b,c,d, etc.. The defaults are: SCAN ERASE 0 ADD
          0


       With  scan345  >=  2.0,  instead of COMMAND, the following
       keywords can be used to access the whole range of commands
       for the scanner and base:

        +o IPS   <no>  <mode>  <par1>  <par2> <par3> <par4> <par5>
          <str>:

        +o SYSTEM <command>

       Either IPS or SYSTEM will overwrite all COMMAND  keywords.
       Use  these keywords very carefully and only after consult-
       ing mar research.


       The following keywords in $MARLOGDIR/mar.com are mandatory
       only when doing a scan:


       _D_I_R_E_C_T_O_R_Y _<_d_i_r_e_c_t_o_r_y_>
              Specifies the output directory for image files.
              Default: DIRECTORY current_directory


       _R_O_O_T _<_r_o_o_t_>
              Specifies  the  root  name of the output image when
              doing scans.  The syntax is:  <string>_<no>,  where
              <string>  is  any  string and <no> is a three digit
              number, e.g. 001.
              Default: ROOT xtal_001


       _M_O_D_E _<_s_c_a_n_m_o_d_e_>
              Specifies the scan mode. The number range from 0 to
              7. The scanmodes are as follows:
              MODE  0  =  2300  pixels, 345 mm diameters, 0.15 mm
              pixelsize
              MODE 1 = 2000 pixels, 300  mm  diameters,  0.15  mm
              pixelsize
              MODE  2  =  1600  pixels, 240 mm diameters, 0.15 mm
              pixelsize
              MODE 3 = 1200 pixels, 180  mm  diameters,  0.15  mm
              pixelsize
              MODE  4  =  3450  pixels, 345 mm diameters, 0.10 mm
              pixelsize
              MODE 5 = 3000 pixels, 300  mm  diameters,  0.10  mm
              pixelsize
              MODE  6  =  2400  pixels, 240 mm diameters, 0.10 mm
              pixelsize
              MODE 7 = 1800 pixels, 180  mm  diameters,  0.10  mm
              pixelsize
              Default: MODE 0


       _F_O_R_M_A_T _<_f_o_r_m_a_t_>
              Specifies  the  image  output format. For scan345 <
              2.0 available formats are: 0 = spiral output  only,
              1  =  mar345  style output, 3 = image style output.
              For scan345 >=  2.0,  available  format  specifiers
              are: MAR345, IMAGE and SPIRAL.
              In   scan345  >=  3.0, the imgCIF/CBF output format
              has been added. CBF and imgCIF differ  in  the  way
              the binary data are encoded: CBF uses binary encod-
              ing and is somewhat more compact while in the  img-
              CIF  format, the data are ASCII-encoded. The format
              specifier to use is: CBF and CIF. For more  details
              about    CBF/imgCIF    see    http://ndbserver.rut-
              gers.edu/mmcif/cbf/.
              It is strongly recommended to use the  mar345  for-
              mat!
              Default:  FORMAT  MAR345  (or FORMAT 1 in scan345 <
              2.0)


       The following keywords in $MARLOGDIR/mar.com are optional.
       Their only purpose is to fill up image header entries with
       meaningful values. It is strongly  suggested  to  pass  at
       least  the  PHI, DISTANCE and WAVELENGTH parameters to the
       program.


       _D_I_S_T_A_N_C_E _<_d_i_s_t_a_n_c_e_>
              Specifies the distance crystal-detector in mm.
              Default: 100 mm.


       _W_A_V_E_L_E_N_G_T_H _<_l_a_m_b_d_a_>
              Specifies the used wavelength in Angstroem.
              Default: Taken from configuration file


       _P_H_I _<_s_t_a_r_t_> _<_e_n_d_> _<_o_s_c_i_l_l_a_t_i_o_n_s_>
              Specifies the starting and ending values of the PHI
              axis  in degrees, as well as the number of oscilla-
              tions used.
              Default: Taken from configuration file


       _O_M_E_G_A _<_s_t_a_r_t_> _<_e_n_d_> _<_o_s_c_i_l_l_a_t_i_o_n_s_>
              Specifies the starting and  ending  values  of  the
              OMEGA  axis  in  degrees,  as well as the number of
              oscillations used.
              Default: Taken from configuration file


       _C_H_I _<_c_h_i_>
              Specifies the position of the CHI axis in  degrees.
              Default: Taken from configuration file


       _T_H_E_T_A _<_2_-_t_h_e_t_a_>
              Specifies  the  position  of  the  2-THETA  axis in
              degrees.
              Default: Taken from configuration file


       _T_I_M_E _<_e_x_p_o_s_u_r_e_-_t_i_m_e_>
              Specifies the used exposure time in seconds.
              Default: TIME 60.0


       _C_O_L_L_E_C_T _<_m_o_d_e_>
              Specifies the type of exposures: TIME controlled or
              X-ray DOSE controlled. In scan345 < 2.0, enter COL-
              LECT 0 (time mode) or COLLECT  1  (dose  mode),  in
              scan345 >= 2.0 give, COLLECT TIME <time> or COLLECT
              DOSE <dose>.
              Default: COLL TIME 60.0  (scan345 >= 2.0) or COLL 1
              (scan345 < 2.0)


       _S_O_U_R_C_E _<_X_-_r_a_y___s_o_u_r_c_e_>
              String to specify the type of X-ray source.
              Default: Taken from configuration file


       _F_I_L_T_E_R _<_m_o_n_o_c_h_r_o_m_a_t_o_r_>
              String to specify the type of monochromator used.
              Default: Taken from configuration file


       _R_E_M_A_R_K _<_r_e_m_a_r_k_>
              String for additional comments.
              Default: None


       _B_E_A_M _<_s_l_i_t___X_> _<_s_l_i_t___Y_>
              Specifies  the  aperture of the collimator in X and
              Y.
              Default: Taken from configuration file.


       _P_O_L_A_R_I_Z_A_T_I_O_N _<_p_o_l_>
              Specifies the polarization factor of the beam.
              Default: Taken from configuration file.


       _P_O_W_E_R _<_k_V_> _<_m_A_>
              Specifies the power settings of  the  X-ray  source
              (kiloVolt, milliAmps).
              Default: Taken from configuration file.


EENNVVIIRROONNMMEENNTT
       The following logical names must be assigned:

       _M_A_R_T_A_B_L_E_D_I_R_:
              Location  of  scanner specific calibration and con-
              figuration files.

       _M_A_R___S_C_A_N_N_E_R___N_O
              Serial number of scanner.

       _M_A_R_L_O_G_D_I_R
              Directory where log files will go.


IINNPPUUTT FFIILLEESS
       The program requires the following input files:

       _$_M_A_R_T_A_B_L_E_D_I_R_/_m_a_r_2_3_0_0_._$_M_A_R___S_C_A_N_N_E_R___N_O_:
              Scanner specific calibration table used for  trans-
              formation  of  the  images  collected  with 0.15 mm
              pixelsize.

       _$_M_A_R_T_A_B_L_E_D_I_R_/_m_a_r_3_4_5_0_._$_M_A_R___S_C_A_N_N_E_R___N_O_:
              Scanner specific calibration table used for  trans-
              formation of the images collected with 0.10 mm pix-
              elsize.

       _$_M_A_R_T_A_B_L_E_D_I_R_/_c_o_n_f_i_g_._$_M_A_R___S_C_A_N_N_E_R___N_O_:
              Scanner specific configuration file (Ascii).

       _$_M_A_R_L_O_G_D_I_R_/_m_a_r_._c_o_m_.
              Keyworded ASCII file containing commands and  other
              parameters.


OOUUTTPPUUTT FFIILLEESS
       Besides  the  desired image, the program produces the fol-
       lowing output files:

       _$_M_A_R_L_O_G_D_I_R_/_l_a_s_t_._l_o_g_:
              Contains the version number of the latest log file.

       _$_M_A_R_L_O_G_D_I_R_/_m_a_r_._l_o_g___N_O _(_s_c_a_n_3_4_5 _< _2_._0 _o_n_l_y_)_:
              Latest  log  file.  NO  ranges  from 1 to 99 and is
              increased with each call of program mar345. If NO >
              99, NO = 1.

       _$_M_A_R_L_O_G_D_I_R_/_l_o_g_/_m_a_r_._l_o_g_._N_O _(_s_c_a_n_3_4_5 _>_= _2_._0 _o_n_l_y_)_:
              Latest  log  file.  NO  ranges  from 1 to 99 and is
              increased with each call of program mar345. If NO >
              99, NO = 1.

       _$_M_A_R_L_O_G_D_I_R_/_s_p_y_/_m_a_r_._s_p_y_._N_O _(_s_c_a_n_3_4_5 _>_= _2_._0 _o_n_l_y_)_:
              Latest  spy  file.  Output will be produced only if
              "USE SPY" is given in the configuration file.

       _$_M_A_R_L_O_G_D_I_R_/_m_a_r_._s_t_a_t_u_s _(_s_c_a_n_3_4_5 _>_= _2_._0 _o_n_l_y_)_:
              Current scanner status:  DISTANCE,  PHI,  currently
              active  tasks  and hardware bits (currently undocu-
              mented). The current status will be updated approx.
              once  per  second.  This file is being used only if
              "USE STATUS" is given.

       _$_M_A_R_L_O_G_D_I_R_/_m_a_r_._m_e_s_s_a_g_e_.
              This file will be truncated at the  start  of  each
              new  task. The progress of the current command will
              be logged into this file. If the task has finished,
              the file will be closed.


EEXXAAMMPPLLEESS
       _s_c_a_n_3_4_5 _-_p_o_r_t _4_5_3_2 _-_h_o_s_t _m_a_r_s


SSEEEE AALLSSOO
       mar345_config_file,  mar345,  marView, marTools, mar345xf,
       mar345_formats, marpack, marcvt.


AAUUTTHHOORR
       Claudio Klein, Marresearch G.m.b.H., Norderstedt, Germany


CCOOPPYYRRIIGGHHTT
       (C) Copyright 2000-2004 Marresearch G.m.b.H., Norderstedt,
       Germany


AADDDDRREESSSS
      --------------------------------------------------------------

      Marresearch G.m.b.H.            Phone: +49 - (40) - 529 884-0
      Hans-Boeckler-Ring 17            FAX: +49 - (40) - 529 884-20
      D-22851 Norderstedt - GERMANY            info@marresearch.com
                                               www.marrresearch.com
      --------------------------------------------------------------




scan345                    09 Nov 2000                 scan345(1)
